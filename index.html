<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roleta Trinacria PRO</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#071127;color:#fff;text-align:center;}
h1{margin:14px 0;}
#wheelCanvas{margin:20px auto;display:block;border-radius:12px;}
button{padding:12px 18px;margin:10px;font-size:18px;border:none;border-radius:10px;background:#eab308;color:#072029;font-weight:bold;cursor:pointer;}
input[type=text]{padding:10px;margin:5px;font-size:16px;border-radius:8px;border:none;width:120px;}
#message{margin-top:12px;font-weight:bold;font-size:18px;}
.history{margin-top:20px;text-align:left;max-height:200px;overflow:auto;}
.history table{width:100%;border-collapse:collapse;color:#fff;}
.history th, .history td{padding:6px;border-bottom:1px solid rgba(255,255,255,0.2);}
</style>
</head>
<body>

<h1>Roleta Trinacria PRO</h1>
<div>
<input id="firstName" type="text" placeholder="Nome" />
<input id="lastName" type="text" placeholder="Sobrenome" />
<button id="spinBtn">GIRAR</button>
</div>

<canvas id="wheelCanvas" width="400" height="400"></canvas>
<div id="message">Preencha seu nome e gire a roleta!</div>

<div class="history">
<h3>Hist√≥rico</h3>
<table>
<thead><tr><th>Nome</th><th>Pr√™mio</th><th>Data/Hora</th></tr></thead>
<tbody id="historyBody"></tbody>
</table>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// CONFIGURA√á√ÉO
const SEGMENTS = [5,7,10,12,15,20,'Abridor','Misterioso'];
const WEIGHTS = [40,25,15,10,7,3,15,3];
const COLORS = ['#0ea5a4','#34d399','#60a5fa','#f97316','#f43f5e','#a78bfa','#facc15','#ff6f61'];
const LOCAL_KEY = 'trinacria_wheel';
const SPIN_COOLDOWN = 7*24*60*60*1000;

// ELEMENTOS
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const firstNameInput = document.getElementById('firstName');
const lastNameInput = document.getElementById('lastName');
const messageEl = document.getElementById('message');
const historyBody = document.getElementById('historyBody');

// FUN√á√ïES
function randomWeight(weights){
    const total = weights.reduce((a,b)=>a+b,0);
    let rand = Math.random()*total;
    for(let i=0;i<weights.length;i++){
        if(rand<weights[i]) return i;
        rand -= weights[i];
    }
    return weights.length-1;
}

function vibrate(){if(navigator.vibrate){navigator.vibrate([100,50,100]);}}

function confettiPrize(prize){
    if(prize==='Abridor') confetti({particleCount:80,spread:70,colors:['#facc15','#ffeb3b','#ffe066']});
    else if(prize==='Misterioso') confetti({particleCount:60,spread:100,colors:['#ff6f61','#ff8a65','#ffa69e']});
    else if(prize==='20') confetti({particleCount:100,spread:90,colors:['#a78bfa','#c084fc','#d8b4fe']});
    else if(prize==='15') confetti({particleCount:80,spread:80,colors:['#f43f5e','#fb7185']});
    else if(prize==='10') confetti({particleCount:60,spread:70,colors:['#60a5fa','#3b82f6']});
    else confetti({particleCount:40,spread:60,colors:['#34d399','#0ea5a4']});
}

function getPrizeMessage(prize,name){
    if(prize==='Abridor'){
        const frases=[
          `üéâ Parab√©ns, ${name}! Voc√™ ganhou um abridor exclusivo na sua pr√≥xima compra!`,
          `üç∑ Uau, ${name}! Um abridor de vinho te espera na pr√≥xima compra!`,
          `ü•Ç Parab√©ns, ${name}! Abridor especial para voc√™!`,
          `‚ú® Que sorte, ${name}! Um abridor incr√≠vel na sua pr√≥xima compra!`,
          `üéÅ Surpresa, ${name}! Voc√™ ganhou um abridor!`
        ];
        return frases[Math.floor(Math.random()*frases.length)];
    }
    else if(prize==='Misterioso'){
        return `üéâ Parab√©ns, ${name}! Voc√™ ganhou um pr√™mio misterioso!`;
    }
    else{
        const frases=[
          `üéâ Parab√©ns, ${name}! Voc√™ ganhou ${prize}% de desconto!`,
          `Uau, ${name}! Desconto especial de ${prize}% liberado!`,
          `Seu pr√™mio, ${name}! Aproveite ${prize}% off!`,
          `üéÅ Que sorte, ${name}! ${prize}% de desconto!`,
          `‚ú® Parab√©ns, ${name}! ${prize}% de desconto exclusivo!`
        ];
        return frases[Math.floor(Math.random()*frases.length)];
    }
}

function saveHistory(first,last,prize){
    const hist = JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]');
    hist.push({first,last,prize,date:Date.now()});
    localStorage.setItem(LOCAL_KEY,JSON.stringify(hist));
    loadHistory();
}

function loadHistory(){
    const hist = JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]');
    historyBody.innerHTML='';
    hist.slice(-20).reverse().forEach(e=>{
        let badge='';
        if(e.prize==='20'||e.prize==='Abridor') badge=' üèÖ';
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${e.first} ${e.last}${badge}</td><td>${e.prize}</td><td>${new Date(e.date).toLocaleString()}</td>`;
        historyBody.appendChild(tr);
    });
}

// DESENHAR ROLETA
function drawWheel(rotation=0){
    const w=canvas.width; const h=canvas.height; const cx=w/2; const cy=h/2;
    const seg = SEGMENTS.length; const angle = 2*Math.PI/seg;
    ctx.clearRect(0,0,w,h);
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(rotation);
    for(let i=0;i<seg;i++){
        ctx.beginPath(); ctx.moveTo(0,0);
        ctx.arc(0,0,w/2, i*angle,(i+1)*angle);
        ctx.closePath(); ctx.fillStyle = COLORS[i%COLORS.length]; ctx.fill();
        ctx.save(); ctx.rotate((i+0.5)*angle); ctx.textAlign='right'; ctx.fillStyle='#021124'; ctx.font=`bold 20px Arial`;
        ctx.fillText(SEGMENTS[i],w/2-20,10); ctx.restore();
    }
    ctx.restore();
}
drawWheel();

// GIRAR ROLETA
let spinning=false;
function spinWheel(first,last){
    if(spinning)return;
    const lastSpin = parseInt(localStorage.getItem('lastSpin')||'0');
    if(Date.now()-lastSpin<SPIN_COOLDOWN){alert('Voc√™ s√≥ pode girar 1 vez por semana!');return;}
    spinning=true; vibrate();
    const index=randomWeight(WEIGHTS);
    let rotation = 360*5 + index*(360/SEGMENTS.length) + Math.random()*30;
    let current = 0, speed = 25;
    function step(){
        if(current<rotation){
            current+=speed; speed*=0.97;
            drawWheel(current*Math.PI/180);
            requestAnimationFrame(step);
        } else {
            const prize = SEGMENTS[index];
            messageEl.textContent = getPrizeMessage(prize,first);
            confettiPrize(prize);
            saveHistory(first,last,prize);
            localStorage.setItem('lastSpin',Date.now());
            spinning=false;
        }
    }
    step();
}

// EVENTOS
spinBtn.addEventListener('click',()=>{
    const first = firstNameInput.value.trim();
    const last = lastNameInput.value.trim();
    if(!first||!last){alert('Preencha nome e sobrenome!'); return;}
    spinWheel(first,last);
});

loadHistory();
</script>
</body>
</html>
